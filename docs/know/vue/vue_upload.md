--- 
title: 利用minio分片上传
date: 2021-06-09 08:49:41
author: 'Mr.Lan'
sidebar: 'auto'
categories: 
 - 前端
tags: 
 - vue
 - minio
 - upload
publish: true
autoGroup-1: 分片上传
---
> 利用minio进行大文件的分片上传，分片上传的其中一种方式
<!-- more -->
***
## **1. 简述**
为什么分片和好处有以下几个点

+ 由于大文件上传时间问题会导致接口超时
+ 网络波动可能会导致中途的上传失败
+ 分片后能够获取上传进度
+ 分片能实现断点续传
+ 分片能实现同文件妙传

## **2. 大致实现**
1. 前端读取文件获取MD5
2. 按照每片大小计算总片数
3. 发起初始化请求参数就是文件的MD5和总片数
4. 后端校验文件是否存在是否有上传记录，返回minio的文件上传地址和其所对应的片号
5. 前端接收将文件进行切割，依次请求对应的minio地址
6. 等待全部上传完毕发起合并请求
7. 后端接收后开始合并所有文件，最后删除分片数据
8. 前端收到成功消息提交文件大小，文件名称，MD5或者能够作为文件标识的参数，并且附带额外的需求数据，例如文件所属用户，提交上级位置`parentId`等。让后端将文件路径与数据表关联（按应用场景需求，确认书否需要此步）

这样整体的分片上传思路就整理出来了
## **3. 代码**
这里只讲述前端的实现逻辑
### 3.1 获取文件
首先我们要让浏览器打开文件狂获取文件，而原本的文件获取框长得emmmm。。。

这里要把他隐藏起来通过我们自定义的方式去触发它
``` html
<template>
    <div>
        <input ref="inputUpload" type="file" @change="uploadFile" id="upload" style="display:none">
    </div>
</template>
```
在组件的封装方法中