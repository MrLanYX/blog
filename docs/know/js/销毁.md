--- 
title: js作用域的销毁
date: 2021-12-07 10:52:04
author: 'Mr.Lan'
sidebar: 'auto'
categories: 
 - 前端
tags: 
 - js
 - 作用域
 - 销毁
publish: true
autoGroup-2: js知识点
---

js作用域的销毁、不立即销毁、不销毁
<!-- more -->
::: warning 原文错误
[原文](https://www.cnblogs.com/guorange/p/7210608.html)中第三点 **"作用域的立即销毁"** 应该是 **"作用域不销毁"**
:::

## **1. 作用域销毁**
函数执行会生成私有作用域，执行结束，内部没有外在引用就会正常销毁

## **2. 作用域的不立即销毁**
``` js
function fn(){
    var i=10;
    return function(n){
    console.log(n+i++);
　　}
}
// 1. fn()执行结束后的还需要进行下一步函数的进行
// 2. 暂时不销毁i=10依旧存在
// 3. 输出25，i自加变成11
// 4. 函数执行结束回收return的函数，fn形成的作用域也能够回收，i销毁
fn()(15);
// 再次调用堆内fn，重新开始输出10+20 打印30
fn()(20);
```

## **3. 作用域的不销毁**
函数作用域内存在外部引用，导致不能销毁
``` js
function fn(){
    var i=10;
    return function(n){
    console.log(n+i++);
    }
}
var f=fn();//->fn执行形成一个私有的作用域A,A中有一个私有的变量i=10,A中返回一个地址xxxfff11,被外面的f占用了,那么当前的A就不能销毁了
f(15);//->输出25,让A中的i=11
f(20);//->输出31,让A中的i=12
``` 

## **4. 不销毁的利用**
1. 常见的闭包函数，形成私有作用域，可以参考[js的闭包形成与利用](./js_bibao.md)
2. 等等。

## **5. JS中内存空间释放的问题（堆内存、栈内存）**
谷歌浏览器：

我们开辟一个内存，可能或有一些其他的变量等占用了这个内存，谷歌浏览器都会间隔一段时间看这个内存还有没有被占用，如果发现有没有被占用的内存了，就自己帮我们回收了(内存释放)

火狐和IE：

我们开个内存，当我们引用了它，就在内存中记录一个数,增加一个引用浏览器就把这个数+1，减少一个引用，浏览器就把这个数-1...当减到零的时候浏览器就把这个内存释放了;但是有些情况下(尤其是IE)记着记着就弄乱了，内存就不能释放了-->浏览器的内存泄露